pipeline {
    agent {
        docker {
            image "marfeel/jenkins-maven:v3.6.3-jdk-8"
            label "docker"
            args "-v ${env.JENKINS_HOME}/.m2:/home/jenkins/.m2 "
            reuseNode true
        }
    }
    stages {
        stage('Build artifacts') {
            steps {
                script {
                    configFileProvider([
                            configFile(
                                    fileId: '183e2f77-8ab5-47d2-bd64-4cbae814c3f7',
                                    targetLocation: '.',
                                    variable: 'MVN_NEXUS')
                    ]) {}
                }
                sh 'mvn clean package -U -s nexus_maven_settings_read_only_xml -Dmaven.test.skip=false -Pspringboot'
            }
        }
        stage('Store artifacts') {
            steps {
                archiveArtifacts artifacts: 'target/*.jar', defaultExcludes: true, caseSensitive: true
            }
        }
    }
    post {
        always {
            cleanWs()
            echo "Job ran @ ${JENKINS_NODE_NAME}"
        }
    }
    options {
        buildDiscarder(logRotator(daysToKeepStr:'60'))

        timeout(time: 20, unit: 'MINUTES')
        timestamps()
    }
}